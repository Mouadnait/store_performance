{% extends 'base.html' %}
{% load static %}

{% block style-content %}
    <link rel="stylesheet" href="{% static 'css/profile.css' %}">
{% endblock style-content %}

{% block title %}My Profile | Store Performance{% endblock title %}

{% block content-title %}My Profile{% endblock content-title %}

{% block content %}
<div class="profile-container">
    <!-- Profile Edit Form -->
    <div class="profile-card">
        <div class="profile-header">
            <h2>User Profile Information</h2>
            <span class="badge {% if is_admin %}badge-admin{% else %}badge-user{% endif %}">
                {% if is_admin %}Administrator{% else %}User{% endif %}
            </span>
        </div>

        {% if messages %}
        <div style="padding: 10px; margin-bottom: 15px; border-radius: 5px;">
            {% for message in messages %}
                {% if message.tags == 'error' %}
                    <div style="background-color: #ffcccc; border: 1px solid #ff6666; padding: 10px; border-radius: 5px;">
                        <strong>Error:</strong> {{ message }}
                    </div>
                {% elif message.tags == 'success' %}
                    <div style="background-color: #ccffcc; border: 1px solid #66ff66; padding: 10px; border-radius: 5px;">
                        <strong>Success:</strong> {{ message }}
                    </div>
                {% endif %}
            {% endfor %}
        </div>
        {% endif %}

        <!-- Profile Form -->
        <form method="POST" enctype="multipart/form-data" class="profile-form">
            {% csrf_token %}
            
            <!-- Profile Image Section -->
            <div class="profile-image-section">
                <div class="profile-image-wrapper">
                    <img src="{% if profile_image %}{{ profile_image }}{% else %}{% static 'images/default-profile.png' %}{% endif %}" 
                         alt="Profile Image" class="profile-image" id="profileImagePreview">
                    <div class="image-overlay">
                        <input type="file" id="profile-image-input" name="image" accept="image/*" onchange="previewProfileImage(this)">
                        <label for="profile-image-input" class="upload-btn">
                            <span class="material-icons-sharp">camera_alt</span>
                            <span>Upload Photo</span>
                        </label>
                    </div>
                </div>
                <p class="image-hint">Recommended size: 400x400px (Max 5MB)</p>
            </div>

            <!-- Personal Information -->
            <div class="form-section">
                <h3>Personal Information</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="username">Username *</label>
                        <input type="text" id="username" name="username" value="{{ user.username }}" required class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address *</label>
                        <input type="email" id="email" name="email" value="{{ user.email }}" required class="form-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="first_name">First Name</label>
                        <input type="text" id="first_name" name="first_name" value="{{ user.first_name }}" class="form-input">
                    </div>
                    <div class="form-group">
                        <label for="last_name">Last Name</label>
                        <input type="text" id="last_name" name="last_name" value="{{ user.last_name }}" class="form-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" name="phone" value="{{ user.phone|default:'' }}" class="form-input" placeholder="e.g., +1 (555) 123-4567">
                    </div>
                </div>

                <div class="form-group">
                    <label for="bio">Bio</label>
                    <textarea id="bio" name="bio" rows="4" class="form-input" placeholder="Tell us about yourself..." maxlength="160">{{ user.bio|default:'' }}</textarea>
                    <p class="hint">Max 160 characters</p>
                </div>
            </div>

            <!-- Account Information (Read-only) -->
            <div class="form-section read-only">
                <h3>Account Information</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Member Since</label>
                        <input type="text" value="{{ user.date_joined|date:'F d, Y' }}" readonly class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Last Login</label>
                        <input type="text" value="{% if user.last_login %}{{ user.last_login|date:'F d, Y \a\t g:i A' }}{% else %}Never{% endif %}" readonly class="form-input">
                    </div>
                </div>

                <div class="form-group">
                    <label>Account Status</label>
                    <input type="text" value="{% if user.is_active %}Active{% else %}Inactive{% endif %}" readonly class="form-input">
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">
                    <span class="material-icons-sharp">save</span>
                    Save Changes
                </button>
                <a href="{% url 'core:dashboard' %}" class="btn btn-secondary">
                    <span class="material-icons-sharp">close</span>
                    Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- Security Section -->
    <div class="profile-card">
        <div class="card-header">
            <h3><span class="material-icons-sharp">security</span> Account Security</h3>
        </div>
        <div class="card-body">
            <div class="security-item">
                <div class="security-info">
                    <h4>Change Password</h4>
                    <p>Update your password to keep your account secure</p>
                </div>
                <button class="btn btn-outline" disabled>
                    <span class="material-icons-sharp">lock</span>
                    Coming Soon
                </button>
            </div>
            
            <div class="security-item">
                <div class="security-info">
                    <h4>Two-Factor Authentication</h4>
                    <p>Add an extra layer of security to your account</p>
                </div>
                <button class="btn btn-outline" disabled>
                    <span class="material-icons-sharp">verified</span>
                    Coming Soon
                </button>
            </div>

            <div class="security-item">
                <div class="security-info">
                    <h4>Active Sessions</h4>
                    <p>Manage your active login sessions across devices</p>
                </div>
                <button class="btn btn-outline" disabled>
                    <span class="material-icons-sharp">devices</span>
                    Coming Soon
                </button>
            </div>

            <div class="security-item">
                <div class="security-info">
                    <h4>Account Deletion</h4>
                    <p class="warning">Permanently delete your account and all associated data</p>
                </div>
                <button class="btn btn-danger" disabled>
                    <span class="material-icons-sharp">delete</span>
                    Coming Soon
                </button>
            </div>
        </div>
    </div>
</div>

<script>
function previewProfileImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            document.getElementById('profileImagePreview').src = e.target.result;
        };
        
        reader.readAsDataURL(input.files[0]);
    }
}
</script>
{% endblock content %}
