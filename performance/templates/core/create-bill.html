{% extends 'base.html' %}
{% load static %}

{% block style-content %}
    <link rel="stylesheet" href="{% static 'css/create-bill.css' %}">
{% endblock style-content %}

{% block title %}New Bill | Store Performance{% endblock title %}

{% block content-title %}Create a new Bill{% endblock content-title %}

{% block content %}
<!-- Bills -->
<div class="content-area">
    {% if messages %}
    <div style="padding: 10px; margin-bottom: 10px; border-radius: 5px;">
        {% for message in messages %}
            {% if message.tags == 'error' %}
                <div style="background-color: #ffcccc; border: 1px solid #ff6666;">
                    <strong>Error:</strong> {{ message }}
                </div>
            {% elif message.tags == 'success' %}
                <div style="background-color: #ccffcc; border: 1px solid #66ff66;">
                    <strong>Success:</strong> {{ message }}
                </div>
            {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    <div class="billApp" style="height: auto;width: 1000px;">
        <form method="POST" id="bill-form" action="{% url 'core:create-bill' %}">
            {% csrf_token %}
            <div class="billheader">
                <div class="firstline d-flex" style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                    <span style="font-weight: 600;">Store Name:&nbsp; {{request.user.username}}&nbsp; </span>
                    <span style="font-weight: 600;">Phone Number:&nbsp; {{request.user.phone}}&nbsp; </span>
                </div>

                <!-- Client Information Section -->
                <div class="firstline d-flex" style="margin-top: 15px; align-items: center;">
                    <span style="min-width: 120px;">Client Name:</span>
                    <input type="text" name="clientName" id="clientName" required placeholder="Enter client name" style="flex: 1; margin-right: 20px;">

                    <span style="min-width: 80px;">Date:</span>
                    <input type="date" name="billDate" id="billDate" required style="flex: 1;">
                </div>

                <!-- Client Contact Information -->
                <div class="firstline d-flex" style="margin-top: 15px; align-items: center;">
                    <span style="min-width: 120px;">Phone:</span>
                    <input type="tel" name="phone" id="phone" placeholder="Client phone (optional)" style="flex: 1; margin-right: 20px;">

                    <span style="min-width: 80px;">Email:</span>
                    <input type="email" name="email" id="email" placeholder="Client email (optional)" style="flex: 1;">
                </div>

                <!-- Client Address -->
                <div class="firstline d-flex" style="margin-top: 15px; margin-bottom: 20px; align-items: center;">
                    <span style="min-width: 120px;">Address:</span>
                    <input type="text" name="address" id="address" placeholder="Client address (optional)" style="flex: 1;">
                </div>

            </div>

            <div class="billbody" style="width: calc(100% - -110px);">
                <table>
                    <thead>
                        <tr>
                            <th style="width: 115px;">
                                <div>Quantity</div>
                            </th>
                            <th style="width: 700px;">
                                <div>Description</div>
                            </th>
                            <th style="width: 115px;">
                                <div>Price</div>
                            </th>
                            <th style="width: 115px;">
                                <div>Amount</div>
                            </th>
                            <th style="width: 115px;"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Item rows here -->
                        <tr>
                            <td>
                                <div><input type="number" name="quantity" id="quantity" placeholder="0" step="0.01"></div>
                            </td>
                            <td>
                                <div><input type="text" name="description" id="description" placeholder="Product description"></div>
                            </td>
                            <td>
                                <div><input type="number" name="price" id="price" placeholder="0.00" step="0.01"></div>
                            </td>
                            <td>
                                <div><input type="number" name="amount" id="amount" placeholder="0.00" step="0.01"></div>
                            </td>
                        </tr>
                        <!-- Total Price Row -->
                        <tr>
                            <td colspan="3" style="text-align: right;">
                                <div style="border: 2px solid #FF9494;">Gr. Total:</div>
                            </td>
                            <td>
                                <div style="border: 2px solid #FF9494;"><input type="number" name="totalPrice" id="totalPrice" placeholder="0.00" step="0.01" readonly></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="bill-bottom" style="display: flex;justify-content: space-between;padding: 20px;">
                <button type="button" id="clear-bill-btn">Clear Bill</button>
                <button type="submit" id="save-bill-btn" name="save_bill">Save Bill</button>
            </div>
        </form>
    </div>
</div>
<!-- End of Bills -->

<script>
    // Set today's date by default
    document.getElementById('billDate').valueAsDate = new Date();

    // Clear button functionality
    document.getElementById('clear-bill-btn').addEventListener('click', function() {
        document.getElementById('bill-form').reset();
        document.getElementById('billDate').valueAsDate = new Date();
    });

    // Calculate total price
    document.getElementById('amount').addEventListener('change', function() {
        const amount = parseFloat(document.getElementById('amount').value) || 0;
        document.getElementById('totalPrice').value = amount.toFixed(2);
    });
</script>
{% endblock content %}